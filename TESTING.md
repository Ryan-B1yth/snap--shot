# Testing

## Contents 
- [Automated Testing](#automated-testing)
  - [HTML validation](#w3c-markup-validator)
  - [CSS validation](#w3c-css-validator)
  - [JS validation](#jshint-javascript-validator)
  - [PEP8 validation](#pep8-validation)
  - [Lighthouse testing](#lighthouse-testing-in-devtools)
  - [Unit testing](#unit-testing)
- [Manual testing](#manual-testing)
- [Testing User Stories](#testing-user-stories)
- [Bugs](#bugs)

## Automated Testing

- Every file in this project was subjected to its file type's respective validator and passed 100% as seen below. Not all results are displayed as many of them look exactly the same however I have picked the files with the largest / more complex code base to demonstrate their results. 

### [W3C Markup Validator](https://validator.w3.org/) 

- Below are the results for the main pages of the site. The home page, products page, product detail page, product edit page, and profile page were chosen to display the main functional pages of the site. The final image is a screenshot of all the errors the validator threw for the checkout page. This is there to show the only errors that were being thrown when pages had to be tested through direct text input.

  - Validation before

    ![HTML Validation Before](static/assets/documentation/images/html_validation_before.png)

  - Validation after

    ![HTML Validation After](static/assets/documentation/images/html_validation_after.png)

  - Products before

    ![HTML VProducts before](static/assets/documentation/images/html_validation_products_before.png)
  
  - Products after 

    ![HTML PProducts after ](static/assets/documentation/images/html_validation_products_after.png)

  - Product detail 

    ![HTML Product detail](static/assets/documentation/images/html_validation_product_detail.png)

  - Product edit

    ![HTML Product edit](static/assets/documentation/images/html_validation_product_edit.png)

  - Profile

    ![HTML Profile](static/assets/documentation/images/html_validation_profile.png)
  
  - Checkout 

    ![HTML Checkout](static/assets/documentation/images/html_validation_text_input.png)


### [W3C CSS Validator](https://jigsaw.w3.org/css-validator/#validate_by_input) 

- Again, below are the results for some of the larger, more complex CSS file.

  - styles.css

  ![Styles CSS](static/assets/documentation/images/styles_css_validation.png)

  - products.css

  ![Products CSS](static/assets/documentation/images/products_css_validation.png)
  
  - product_detail.css

  ![Product Detail CSS](static/assets/documentation/images/product_detail_css_validation.png)

  - product_review.css

  ![Product Review CSS](static/assets/documentation/images/product_review_css_validation.png)

  - testimonies.css

  ![Testimonies CSS](static/assets/documentation/images/testimonies_css_validation.png)
     
### [JSHint JavaScript Validator](https://jshint.com/) 

- The JavaScript in this project was separted into very small files for their respective pages containing perhaps a single function. The largest three files with complex functionality are shown below.

  - Products

  ![Products JS](static/assets/documentation/images/products_js_validation.png)

  - Product detail

  ![Product detail JS](static/assets/documentation/images/product_detail_js_validation.png)

  - Stripe

  ![Stripe elements JS](static/assets/documentation/images/stripe_elements_js_validation.png)

### [PEP8 Validator](http://pep8online.com/)

- Due to the large number of Python files in this project, and with most of them being generated by Django, only files that were changed in development were put through the validator. All passed with no issues and the ones shown below are the largest and again, the most complex.

  - Product views.py

  ![Product views.py](static/assets/documentation/images/product_views_py_validation.png)

  - Product forms.py

  ![Product form.py](static/assets/documentation/images/product_form_py_validation.png)

  - Product models.py

  ![Product models.py](static/assets/documentation/images/product_models_py_validation.png)

  - Project urls.py

  ![Project urls.py](static/assets/documentation/images/project_urls_py_validation.png)

  - Stripe webhooks

  ![Stripe webhooks](static/assets/documentation/images/stripe_py_validation.png)

### Lighthouse Scores

- The lighthouse scores below show some of the best and worst scores various pages on the site receive in both desktop view and mobile view. Not all are shown but all were tested and all scored within similar ranges.

  - Home page

    - Desktop
  ![Lighthouse home](static/assets/documentation/images/lighthouse_home.png)

    - Mobile
  ![Lighthouse home mobile](static/assets/documentation/images/lighthouse_home_mobile.png)

  - Product page

    - Desktop
  ![Lighthouse products](static/assets/documentation/images/lighthouse_products.png)

    - Mobile
  ![Lighthouse home mobile](static/assets/documentation/images/lighthouse_products_mobile.png)
  
  - Product detail page

    - Desktop
  ![Lighthouse product detail](static/assets/documentation/images/lighthouse_product_detail.png)

    - Mobile
  ![Lighthouse home mobile](static/assets/documentation/images/lighthouse_product_detail_mobile.png)
  
  - Form pages

    - Desktop
  ![Lighthouse form](static/assets/documentation/images/lighthouse_form.png)

    - Mobile
  ![Lighthouse home mobile](static/assets/documentation/images/lighthouse_form_mobile.png)
    
## Unit Testing 
  - Automated tests were written towards the end of the project and followed similarly to tests written for previous projects. Once again [Natalie Kate Alexander's](https://github.com/natalie-kate/music_to_my_ears) 'Music to my Ears' project was a huge help with the fundamental structure of how to test using TestCase in Python. Forms, models, and views were tested in each app that used a significant amount of code in these files. The test files are in a test folder inside each app.

  ![Coverage Report](static/assets/documentation/images/coverage_report.PNG)

  - A coverage report of the project gave a 68% coverage. Ideally this would be higher however with this percentage covered, and the manual tests covering the situations where automated testing would've become too complicated, I am happy with coverage.

## Testing User Stories 

- All user stories set out before development were tested and passed as seen below.

- #### Unregistered Visitor
  - As an unregistered user, I want to be able to: 
    - View all products so that I can select items to purchase.
    ![View all products](static/assets/documentation/images/view_all_products.png)
      - Users can view all products by clicking All Items.
    - View a selection of products by category so that I can narrow my search by type.
    ![View some products](static/assets/documentation/images/view_some_products.png)
      - Users have two categories to choose from; Physical and Digital.
    - See all a product's detail so that I can find the price and read the description of a product.
    ![View product detail](static/assets/documentation/images/view_product_detail.png)
      - Clicking See More will take you to the product detail page.
    - Search for specific products so that I can find exactly what I am looking for.
    ![Search products](static/assets/documentation/images/search_products.png)
      - The search bar is fully functional and searches names and descriptions.
    - Filter by rating and price so that I can shop for the best items.
    ![Filter by price](static/assets/documentation/images/filter_price.png)
    ![Filter by price](static/assets/documentation/images/filter_rating.png)
      - Users can filter by price and rating by clicking either link.

- #### First Time Visitor (in addition to above)
  - As a first time user, I want to be able to:
    - Navigate the site easily and intuitively.
    - Find what I am looking for easily.
    ![Mobile navigation](static/assets/documentation/images/mobile_nav.png)
    ![Desktop navigation](static/assets/documentation/images/desktop_nav.png)
      - The navigation is always right at the top of the screen and is displayed as a user would expect.
    - Keep track of my basket total so I do not overspend.
    ![Basket](static/assets/documentation/images/basket.png)
      - The basket total is always in the top right and clicking it will take you to the basket page where the total is split into the item's total and delivery if applicable.
    - Add and remove item's from my basket so I can make sure I have the correct items, and quantities.
    ![Adjust basket](static/assets/documentation/images/adjust_basket.png)
      - Users can add and remove items from the basket using either the plus and minus buttons and clicking Update, or hitting Remove which removes all items of that type from the basket.
    - Checkout easily and be sent confirmation of my purchase to my email.
    ![Checkout](static/assets/documentation/images/checkout.png)
    ![Confirmation email](static/assets/documentation/images/confirmation_email.png)
      - Checking out is just one form that vanishes when submitted to prevent users from attempting to do so multiple times. A confirmation email is sent with the order number and a run down of what they bought.

- #### Registered Returning Visitor Goals
  - As a registered user, I want to be able to:
    - Save my checkout information so I can purchase items easier the next time I visit the site.
    ![Save information](static/assets/documentation/images/save_info.png)
      - Information at checkout can be saved by checking the box.
    - Sign up to a news letter so that I can be told about special offers and savings.
    ![News letter](static/assets/documentation/images/news_letter.png)
      - The site provides a form for a news letter service provided by Mail Chimp.
    - Update my information when it changes so that my items are aways delivered to the correct address.
    ![Update information](static/assets/documentation/images/update_info.png)
      - Navigating to profile from the top of the page or the dropdown menu will take a user to the profile page where their information can be changed at any time.
    - Recieve an email to verify my registration so that I can be sure I have an account.
    ![Verify email](static/assets/documentation/images/verify_email.png)
    ![Verification toast](static/assets/documentation/images/verify_toast.png)
      - An email is sent to a users inputted email for verification and the user is told this on the page and in a helpful pop-up in the top right corner.
    - Change and recover my password so I do not have to create a new account if I forget it.
    ![Forgot password](static/assets/documentation/images/forgot_pass.png)
    ![Change password](static/assets/documentation/images/change_pass.png)
      - Users have the option to change their password on the profile page, and can recover their password on the login page by submitting their email and following the instructions.
    - Access a profile so that I can view my order history, confirmations, and payment information.
    ![Order history](static/assets/documentation/images/order_history.png)
      - The user profile displays all confirmed orders with their order number, totals, and contents.

- #### Superuser goals
  - As a superuser / admin, I want to be able to:
    - Add, edit, and remove items from the site so that I can sell more products and remove the products that are not being sold to improve revenue.
    ![Add product](static/assets/documentation/images/add_product.png)
    ![Edit product](static/assets/documentation/images/edit_product.png)
      - Superusers / admin have full CRUD control of the site. These pages can only be accessed by superusers.
      
## Manual Testing

- Manual testing of the site was undertaken at every step of development. 

- All URLs were followed to ensure they resolved correctly. An error message page is displayed to a user who tries to navigate to a page they shouldn't have access to and allows them to navigate back to the home page.

- All CRUD functionality on the user end was tested manually. As only the superuser will have access to CRUD functionality, only the superuser can access site management, and add, edit, and delete products from the site.

- Forms have validation and will not post data if any errors are raised.

- The site was tested on Google Chrome using their developer tools and viewed on Firefox, Microsoft Edge, and Safari to ensure it worked across multiple platforms. The site was also viewed on multiple devices of varying screen sizes to ensure its responsive design works as expected. 

## Bugs

- Bugs were identified either through manual or automated testing. The command line in Gitpod was used primarily to debug errors as and when they happened. The logs of Heroku and Stripe were also considered when an error occured that involved either one of these services. Django provides an excellent error / debugging page when something goes wrong within a Django project which was also used a lot during developemnt. 

- Screen sizes of exactly 768px wide will experience an issue where the header completely disappears and is not reachable from anywhere on the site. This bug is strange as practices for responsove design used in previous projects that don't cause this issue were used here so why this happens is unclear. The switch between the desktop header and the mobile header happens at a screen width of 768px, meaning that above the limit, the desktop header should display, and anything at or below the limit should trigger the mobile header. This bug couldn't be fixed by changing the limits as either neither header would show up for multiple pixel widths, or both of them would.